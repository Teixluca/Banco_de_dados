using MySql.Data.MySqlClient;
namespace MySQL.ConsoleApp
{
    class Program
    {
        static string connectionString =
            "Server=localhost;Database=cadastro_db;Uid=root;Pwd=;";
        static void Main(string[] args)
        {
            int opcao;
            do
            {
                Console.WriteLine("\nEscolha uma opção: ");
                Console.WriteLine(" 1. Inserir Usuario");
                Console.WriteLine(" 2. Ler Usuario");
                Console.WriteLine(" 3. Atualizar Usuario");
                Console.WriteLine(" 4. Deletar Usuario");
                Console.WriteLine(" 5. Sair");

                opcao = int.Parse(Console.ReadLine());

                switch (opcao)
                {
                    case 1:
                        InserirUsuario();
                        break;
                    case 2:
                        LerUsuario();
                        break;
                    case 3:
                        AtualizarUsuario();
                        break;
                    case 4:
                        DeletarUsuario();
                        break;
                    case 5:
                        Sair();
                        break;
                }
            } while (opcao != 5);
        }
        static void InserirUsuario()
        {
            Console.WriteLine("Nome: ");
            string nome = Console.ReadLine();

            Console.WriteLine("Email: " );
            string email = Console.ReadLine();

            using (MySqlConnection conn = new MySqlConnection(connectionString)) 
            { conn.Open();
                string query = "INSERT INTO usuarios(nome, email) VALUES (@nome, @email)";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@nome", nome);
                cmd.Parameters.AddWithValue("@email", email);
                cmd.ExecuteNonQuery();
                Console.WriteLine("Usuario inserido com sucesso!");
                Console.ReadKey();
            }
        }

        static void LerUsuario()
        {
            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();
                string query = "SELECT * FROM usuarios";
                MySqlCommand cmd = new MySqlCommand(query, conn);

                using (MySqlDataReader reader = cmd.ExecuteReader())
                {
                    while (reader.Read()) {
                        Console.WriteLine($"ID: { reader["id"]}, Nome: { reader["nome"]}, Email: { reader["email"]}");
                    }
                }

            }
        }
        
        static void AtualizarUsuario()
        {
            Console.Write("ID do usuario a ser atualizado: ");
            int id = int.Parse(Console.ReadLine());

            Console.WriteLine("Novo nome: ");
            string nome = Console.ReadLine();

            Console.WriteLine("Novo email: ");
            string email = Console.ReadLine();

            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();
                string query = "UPDATE usuarios SET nome = @nome, email = @email WHERE id = @id";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@nome", nome);
                cmd.Parameters.AddWithValue("@id", id);
                cmd.Parameters.AddWithValue("@email", email);

                cmd.ExecuteNonQuery();
                Console.WriteLine("Usuario Atualizado comsucesso");

            }
          
        }
        static void DeletarUsuario()
        {
            Console.WriteLine("ID do usuario a ser deletado");
            int id = int.Parse(Console.ReadLine());

            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();
                string query = "DELETE FROM usuarios WHERE id = @id";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@id", id);

                cmd.ExecuteNonQuery();
                Console.WriteLine("Usuario deletado com Sucesso! ");
            }
        }

        static void Sair()
        {
            Console.WriteLine("Encerrando o programa...");
        }

    }

}
