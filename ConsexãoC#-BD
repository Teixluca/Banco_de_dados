using System;
using MySql.Data.MySqlClient;
using System.Threading;
namespace MySQL.ConsoleApp
{
    class Program
    {
        static string connectionString =
            "Server=localhost;Database=cadastro_db;Uid=root;Pwd=;";
        static void Main(string[] args)
        {
            int opcao;
            do
            {
                Console.WriteLine("\n\tEscolha uma opção: \n");
                Console.WriteLine(" 1. Inserir Usuario");
                Console.WriteLine(" 2. Ler Usuario");
                Console.WriteLine(" 3. Atualizar Usuario");
                Console.WriteLine(" 4. Deletar Usuario");
                Console.WriteLine(" 5. Sair");
                Console.Write("\n\tOpção: ");

                opcao = int.Parse(Console.ReadLine());

                switch (opcao)
                {
                    case 1:
                        InserirUsuario();
                        break;
                    case 2:
                        LerUsuario();
                        break;
                    case 3:
                        AtualizarUsuario();
                        break;
                    case 4:
                        DeletarUsuario();
                        break;
                    case 5:
                        Sair();
                        break;
                }
            } while (opcao != 5);
        }
        static void InserirUsuario()
        {
            Console.WriteLine("Nome: ");
            string nome = Console.ReadLine();

            Console.WriteLine("Email: ");
            string email = Console.ReadLine();

            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();
                string query = "INSERT INTO usuarios(nome, email) VALUES (@nome, @email)";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@nome", nome);
                cmd.Parameters.AddWithValue("@email", email);
                cmd.ExecuteNonQuery();
                Console.WriteLine("\n\tUsuario inserido com sucesso!");
                Thread.Sleep(3000);
                Console.Clear();
                //Console.ReadKey();
            }
        }

        /*static void LerUsuario()
        {
            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();
                string query = "SELECT * FROM usuarios";
                MySqlCommand cmd = new MySqlCommand(query, conn);

                using (MySqlDataReader reader = cmd.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        Console.WriteLine($"ID: {reader["id"]}, Nome: {reader["nome"]}, \t\tEmail: {reader["email"]}");
                    }

                    Console.ReadKey();
                    Console.Clear();

                }

            }
        }*/

        static void LerUsuario()
        {
            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();
                string query = "SELECT * FROM usuarios";
                MySqlCommand cmd = new MySqlCommand(query, conn);

                using (MySqlDataReader reader = cmd.ExecuteReader())
                {
                    Console.Clear();
                    Console.WriteLine("\nID\tNome\t\t\tEmail");
                    Console.WriteLine("----------------------------------------------");

                    while (reader.Read())
                    {
                        Console.WriteLine($"{reader["id"],-3} {reader["nome"],-20} {reader["email"],-30}");
                    }

                    Console.ReadKey();
                    Console.Clear();
                }
            }
        }


        static void AtualizarUsuario()
        {
            Console.Write("ID do usuario a ser atualizado: ");
            int id = int.Parse(Console.ReadLine());

            Console.WriteLine("Novo nome: ");
            string nome = Console.ReadLine();

            Console.WriteLine("Novo email: ");
            string email = Console.ReadLine();

            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();
                string query = "UPDATE usuarios SET nome = @nome, email = @email WHERE id = @id";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@nome", nome);
                cmd.Parameters.AddWithValue("@id", id);
                cmd.Parameters.AddWithValue("@email", email);

                cmd.ExecuteNonQuery();
                Console.WriteLine("\n\tUsuario atualizado com sucesso");
                Thread.Sleep(3000);
                Console.Clear();
            }

        }
        static void DeletarUsuario()
        {
            Console.WriteLine("ID do usuario a ser deletado");
            int id = int.Parse(Console.ReadLine());

            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();
                string query = "DELETE FROM usuarios WHERE id = @id";
                MySqlCommand cmd = new MySqlCommand(query, conn);
                cmd.Parameters.AddWithValue("@id", id);

                cmd.ExecuteNonQuery();
                Console.WriteLine("\n\tUsuario deletado com Sucesso! ");
                Thread.Sleep(3000);
                Console.Clear();
            }
        }

        static void Sair()
        {
            Console.Clear();
            Console.WriteLine("\n\tEncerrando o programa.");
            Thread.Sleep(1000);
            Console.Clear();
            Console.WriteLine("\n\tEncerrando o programa..");
            Thread.Sleep(1000);
            Console.Clear();
            Console.WriteLine("\n\tEncerrando o programa...");
            Thread.Sleep(1000);
            Console.Clear();
        }

    }

}
